function authenticate_user(e,t,s){var n={username:e,password:MD5(t)};return request_to_api(s,"v2services","authenticateUser",n,API_URL)}function delete_bean(e,t,s,n){var i={username:e,password:MD5(t),beankey:s};return request_to_api(n,"v2services","deletebean",i,API_URL)}function get_apps(e,t,s,n){var i={username:e,password:t,limit:s};return request_to_api(n,"v2services","apps",i,API_URL)}function get_award(e,t,s,n){var i={username:e,password:MD5(t),appkey:s};return request_to_api(n,"v2services","awardcoupon",i,API_URL)}function get_beans(e,t,s,n,i){var a={username:e,password:MD5(t),limit:s,sortby:n};return request_to_api(i,"v2services","beans",a,API_URL)}function get_categories(e,t,s){var n={username:e,password:t};return request_to_api(s,"v2services","categories",n,API_URL)}function get_locations_for_sponsor(e,t,s,n){var i={username:e,password:t,sponsorkey:s};return request_to_api(n,"v2services","sponsorlocations",i,API_URL)}function get_sponsors(e,t,s,n){var i={username:e,password:t,limit:s};return request_to_api(n,"v2services","sponsors",i,API_URL)}function get_winners(e,t){var s={limit:e};return request_to_api(t,"v2services","winners",s,API_URL)}function reedem_bean(e,t,s,n){var i={username:e,password:MD5(t),beankey:s};return request_to_api(n,"v2services","redeembean",i,API_URL)}function register_user(e,t,s,n,i,a,o,r){var u={username:e,password:MD5(t),email:s,zipcode:n,categories:o,lat:i,lon:a};return request_to_api(r,"v2services","registerUser",u,API_URL)}function send_password(e,t){var s={username:e};return request_to_api(t,"v2services","sendpassword",s,API_URL)}function validate_user(e,t){var s={username:e};return request_to_api(t,"v2services","validateuser",s,API_URL)}function parse_apps(e){for(var t=0;numberOfApps>t;t++)push_to_apps(e,t);return e}function push_to_apps(e,t){e.push({appkey:appsArray[t].appkey,appstoreurl:appsArray[t].appstoreurl,description:appsArray[t].description,iconurl:appsArray[t].iconurl,name:appsArray[t].name,publisher:appsArray[t].publisher,publisherkey:appsArray[t].publisherkey,publisherurl:appsArray[t].publisherurl})}function parse_apps_and_callback(e,t){if(e.indexOf(INTERNAL_SERVER_ERROR)>-1)return s=INTERNAL_SERVER_ERROR,void t(s,apps);apps=[],appsArray=[];var s,n=JSON.parse(e),i=n.status;1===i?(appsArray=n.response.apps,numberOfApps=appsArray.length,parse_apps(apps),s=STATUS_SUCCESS,t(s,apps)):(s=STATUS_FAIL,t(s,apps))}function parse_authenticateuser_and_callback(e,t){if(e.indexOf(INTERNAL_SERVER_ERROR)>-1)return o=INTERNAL_SERVER_ERROR,void t(o,i);var s=JSON.parse(e),n=s.status,i=s.response.message,a=s.response.email;""!=a?(sessionStorage.setItem("email",a),$("#email").val(a)):sessionStorage.removeItem("email");var o;1===n?(o=STATUS_SUCCESS,t(o,i,a)):(o=STATUS_FAIL,t(o,i))}function parse_award(e){var t=[];return t.push({awarded:e.awarded,beankey:e.beankey,imageurl:e.imageurl,message:e.message}),t}function parse_award_and_callback(e,t){if(e.indexOf(INTERNAL_SERVER_ERROR)>-1)return n=INTERNAL_SERVER_ERROR,void t(n,award);award=[];var s=JSON.parse(e);console.log("start get json"),console.log(s);var n,i=s.status;1===i?(award=s.response,parse_award(award),n=STATUS_SUCCESS,t(n,award)):(n=STATUS_FAIL,t(n,award))}function parse_beans(e){for(var t=0;numberOfBeans>t;t++)push_to_beans(e,t);return e}function push_to_beans(e,t){e.push({beankey:beansArray[t].beankey,expirationdate:beansArray[t].expirationdate,game:beansArray[t].game,geocodekey:beansArray[t].geocodekey,longdescription:beansArray[t].longdescription,redeembarcodeurl:beansArray[t].redeembarcodeurl,redemptionurl:beansArray[t].redemptionurl,redemptionvalidation:beansArray[t].redemptionvalidation,shortdescription:beansArray[t].shortdescription,sponsorkey:beansArray[t].sponsorkey,sponsorlogourl:beansArray[t].sponsorlogourl,sponsorname:beansArray[t].sponsorname,sponsorurl:beansArray[t].sponsorurl,wondate:beansArray[t].wondate,days:get_expiration_days(beansArray[t].expirationdate)})}function parse_beans_and_callback(e,t){if(e.indexOf(INTERNAL_SERVER_ERROR)>-1)return s=INTERNAL_SERVER_ERROR,void t(s,beans);beans=[],beansArray=[];var s,n=JSON.parse(e),i=n.status;1===i?(beansArray=n.response.beans,numberOfBeans=beansArray.length,parse_beans(beans),s=STATUS_SUCCESS,t(s,beans)):(s=STATUS_FAIL,t(s,beans))}function get_expiration_days(e){var t=new Date(e),s=new Date,n=Math.abs(t.getTime()-s.getTime());return Math.floor(n/864e5)}function parse_categories(e){for(var t=0;numberOfCategories>t;t++)push_to_categories(e,t);return e}function push_to_categories(e,t){e.push({categorykey:categoriesArray[t].categorykey,name:categoriesArray[t].name})}function parse_categories_and_callback(e,t){if(e.indexOf(INTERNAL_SERVER_ERROR)>-1)return s=INTERNAL_SERVER_ERROR,void t(s,categories);categories=[],categoriesArray=[];var s,n=JSON.parse(e),i=n.status;1===i?(categoriesArray=n.response.categories,numberOfCategories=categoriesArray.length,parse_categories(categories),s=STATUS_SUCCESS,t(s,categories)):(s=STATUS_FAIL,t(s,categories))}function parse_deletebean_and_callback(e,t){if(e.indexOf(INTERNAL_SERVER_ERROR)>-1)return n=INTERNAL_SERVER_ERROR,void t(n,a);var s=JSON.parse(e);console.log("this is deletebean json "),console.log(s);var n,i=s.status,a=s.response.message;1===i?(n=STATUS_SUCCESS,t(n,a)):(n=STATUS_FAIL,t(n,a))}function parse_sendpassword_and_callback(e,t){if(e.indexOf(INTERNAL_SERVER_ERROR)>-1)return n=INTERNAL_SERVER_ERROR,void t(n,winners);if(null==e||"undefinied"==e||""==e||"null"==e)return n=STATUS_FAIL,void t(n,a);console.log("this is data"),console.log(e);var s=JSON.parse(e);console.log("this is json from send password"),console.log(s);var n,i=s.status,a=s.response.message;1===i?(n=STATUS_SUCCESS,t(n,a)):(n=STATUS_FAIL,t(n,a))}function parse_redeembean_and_callback(e,t){if(e.indexOf(INTERNAL_SERVER_ERROR)>-1)return n=INTERNAL_SERVER_ERROR,void t(n,a);console.log("this is reedem data"),console.log(e);var s=JSON.parse(e);console.log("this is reedem json "),console.log(s);var n,i=s.status,a=s.response.message;1===i?(n=STATUS_SUCCESS,t(n,a)):(n=STATUS_FAIL,t(n,a))}function parse_register_and_callback(e,t){if(e.indexOf(INTERNAL_SERVER_ERROR)>-1)return n=INTERNAL_SERVER_ERROR,void t(n,a);var s=JSON.parse(e);console.log("this is register json "),console.log(s);var n,i=s.status,a=s.response.message;1===i?(n=STATUS_SUCCESS,t(n,a)):(n=STATUS_FAIL,t(n,a))}function parse_sponsor_locations_and_callback(e,t){if(e.indexOf(INTERNAL_SERVER_ERROR)>-1)return s=INTERNAL_SERVER_ERROR,void t(s,a);console.log("this is data from locations of sponsor"+e);var s,n=JSON.parse(e),i=n.status,a=e;1===i?(s=STATUS_SUCCESS,t(s,a)):(s=STATUS_FAIL,t(s,a))}function parse_sponsors(e){for(var t=0;numberOfSponsors>t;t++)push_to_sponsors(e,t);return e}function push_to_sponsors(e,t){e.push({id:sponsorArray[t].id,sponsorkey:sponsorArray[t].sponsorkey,name:sponsorArray[t].name,siteurl:sponsorArray[t].siteurl,logourl:sponsorArray[t].logourl,category:sponsorArray[t].category,description:sponsorArray[t].description,offer:sponsorArray[t].offer,geocodekey:sponsorArray[t].geocodekey})}function parse_sponsors_and_callback(e,t){if(e.indexOf(INTERNAL_SERVER_ERROR)>-1)return s=INTERNAL_SERVER_ERROR,void t(s,winners);sponsors=[],sponsorArray=[];var s,n=JSON.parse(e),i=n.status;1===i?(sponsorArray=n.response.sponsors,numberOfSponsors=sponsorArray.length,parse_sponsors(sponsors),s=STATUS_SUCCESS,t(s,sponsors)):(s=STATUS_FAIL,t(s,sponsors))}function parse_validateuser_and_callback(e,t){if(e.indexOf(INTERNAL_SERVER_ERROR)>-1)return n=INTERNAL_SERVER_ERROR,void t(n,a);var s=JSON.parse(e);console.log("this is validate json "),console.log(s);var n,i=s.status,a=s.response.message;1===i?(n=STATUS_SUCCESS,t(n,a)):(n=STATUS_FAIL,t(n,a))}function parse_winners(e){for(var t=0;numberOfWinners>t;t++)push_to_winners(e,t);return e}function push_to_winners(e,t){e.push({appkey:winnersArray[t].appkey,appname:winnersArray[t].appname,sponsorlogourl:winnersArray[t].sponsorlogourl,username:winnersArray[t].username})}function parse_winners_and_callback(e,t){if(e.indexOf(INTERNAL_SERVER_ERROR)>-1)return s=INTERNAL_SERVER_ERROR,void t(s,winners);winners=[],winnersArray=[];var s,n=JSON.parse(e),i=n.status;1===i?(winnersArray=n.response.winners,numberOfWinners=winnersArray.length,parse_winners(winners),s=STATUS_SUCCESS,t(s,winners)):(s=STATUS_FAIL,t(s,winners))}function request_to_api(e,t,s,n,i){var a=createCORSRequest("POST",i);return a.withCredentials=!0,a?(a.onload=function(){var t=a.responseText;"winners"===s?parse_winners_and_callback(t,e):"apps"===s?parse_apps_and_callback(t,e):"sponsors"===s?parse_sponsors_and_callback(t,e):"sponsorlocations"===s?parse_sponsor_locations_and_callback(t,e):"beans"===s?parse_beans_and_callback(t,e):"categories"===s?parse_categories_and_callback(t,e):"awardcoupon"===s?parse_award_and_callback(t,e):"registerUser"===s?parse_register_and_callback(t,e):"sendpassword"===s?parse_sendpassword_and_callback(t,e):"deletebean"===s?parse_deletebean_and_callback(t,e):"redeembean"===s?parse_redeembean_and_callback(t,e):"authenticateUser"===s?parse_authenticateuser_and_callback(t,e):"validateuser"===s&&parse_validateuser_and_callback(t,e)},a.onerror=function(){alert("There was an error making the request.")},a.setRequestHeader("Content-Type","application/json;charset=UTF-8"),a.send(JSON.stringify({resource:t,method:s,params:n})),"error"):(alert("CORS not supported"),"corsNotSupported")}function createCORSRequest(e,t){var s=new XMLHttpRequest;return"withCredentials"in s?s.open(e,t,!0):"undefined"!=typeof XDomainRequest?(s=new XDomainRequest,s.open(e,t)):s=null,s}var API_URL="https://api.mybeanjar.com/json/services",INTERNAL_SERVER_ERROR="Internal Server Error",STATUS_SUCCESS="Status success",STATUS_FAIL="Status fail",apps=[],appsArray=[],numberOfApps,currentWinArray=[],beans=[],beansArray=[],numberOfBeans,categories=[],categoriesArray=[],numberOfCategories,MD5=function(e){function t(e,t){return e<<t|e>>>32-t}function s(e,t){var s,n,i,a,o;return i=2147483648&e,a=2147483648&t,s=1073741824&e,n=1073741824&t,o=(1073741823&e)+(1073741823&t),s&n?2147483648^o^i^a:s|n?1073741824&o?3221225472^o^i^a:1073741824^o^i^a:o^i^a}function n(e,t,s){return e&t|~e&s}function i(e,t,s){return e&s|t&~s}function a(e,t,s){return e^t^s}function o(e,t,s){return t^(e|~s)}function r(e,i,a,o,r,u,d){return e=s(e,s(s(n(i,a,o),r),d)),s(t(e,u),i)}function u(e,n,a,o,r,u,d){return e=s(e,s(s(i(n,a,o),r),d)),s(t(e,u),n)}function d(e,n,i,o,r,u,d){return e=s(e,s(s(a(n,i,o),r),d)),s(t(e,u),n)}function l(e,n,i,a,r,u,d){return e=s(e,s(s(o(n,i,a),r),d)),s(t(e,u),n)}function c(e){for(var t,s=e.length,n=s+8,i=(n-n%64)/64,a=16*(i+1),o=Array(a-1),r=0,u=0;s>u;)t=(u-u%4)/4,r=u%4*8,o[t]=o[t]|e.charCodeAt(u)<<r,u++;return t=(u-u%4)/4,r=u%4*8,o[t]=o[t]|128<<r,o[a-2]=s<<3,o[a-1]=s>>>29,o}function m(e){var t,s,n="",i="";for(s=0;3>=s;s++)t=e>>>8*s&255,i="0"+t.toString(16),n+=i.substr(i.length-2,2);return n}function g(e){e=e.replace(/\r\n/g,"\n");for(var t="",s=0;s<e.length;s++){var n=e.charCodeAt(s);128>n?t+=String.fromCharCode(n):n>127&&2048>n?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t}var p,f,b,h,_,y,v,S,j,R=Array(),w=7,A=12,L=17,E=22,I=5,C=9,T=14,B=20,k=4,M=11,N=16,U=23,O=6,Q=10,J=15,V=21;for(e=g(e),R=c(e),y=1732584193,v=4023233417,S=2562383102,j=271733878,p=0;p<R.length;p+=16)f=y,b=v,h=S,_=j,y=r(y,v,S,j,R[p+0],w,3614090360),j=r(j,y,v,S,R[p+1],A,3905402710),S=r(S,j,y,v,R[p+2],L,606105819),v=r(v,S,j,y,R[p+3],E,3250441966),y=r(y,v,S,j,R[p+4],w,4118548399),j=r(j,y,v,S,R[p+5],A,1200080426),S=r(S,j,y,v,R[p+6],L,2821735955),v=r(v,S,j,y,R[p+7],E,4249261313),y=r(y,v,S,j,R[p+8],w,1770035416),j=r(j,y,v,S,R[p+9],A,2336552879),S=r(S,j,y,v,R[p+10],L,4294925233),v=r(v,S,j,y,R[p+11],E,2304563134),y=r(y,v,S,j,R[p+12],w,1804603682),j=r(j,y,v,S,R[p+13],A,4254626195),S=r(S,j,y,v,R[p+14],L,2792965006),v=r(v,S,j,y,R[p+15],E,1236535329),y=u(y,v,S,j,R[p+1],I,4129170786),j=u(j,y,v,S,R[p+6],C,3225465664),S=u(S,j,y,v,R[p+11],T,643717713),v=u(v,S,j,y,R[p+0],B,3921069994),y=u(y,v,S,j,R[p+5],I,3593408605),j=u(j,y,v,S,R[p+10],C,38016083),S=u(S,j,y,v,R[p+15],T,3634488961),v=u(v,S,j,y,R[p+4],B,3889429448),y=u(y,v,S,j,R[p+9],I,568446438),j=u(j,y,v,S,R[p+14],C,3275163606),S=u(S,j,y,v,R[p+3],T,4107603335),v=u(v,S,j,y,R[p+8],B,1163531501),y=u(y,v,S,j,R[p+13],I,2850285829),j=u(j,y,v,S,R[p+2],C,4243563512),S=u(S,j,y,v,R[p+7],T,1735328473),v=u(v,S,j,y,R[p+12],B,2368359562),y=d(y,v,S,j,R[p+5],k,4294588738),j=d(j,y,v,S,R[p+8],M,2272392833),S=d(S,j,y,v,R[p+11],N,1839030562),v=d(v,S,j,y,R[p+14],U,4259657740),y=d(y,v,S,j,R[p+1],k,2763975236),j=d(j,y,v,S,R[p+4],M,1272893353),S=d(S,j,y,v,R[p+7],N,4139469664),v=d(v,S,j,y,R[p+10],U,3200236656),y=d(y,v,S,j,R[p+13],k,681279174),j=d(j,y,v,S,R[p+0],M,3936430074),S=d(S,j,y,v,R[p+3],N,3572445317),v=d(v,S,j,y,R[p+6],U,76029189),y=d(y,v,S,j,R[p+9],k,3654602809),j=d(j,y,v,S,R[p+12],M,3873151461),S=d(S,j,y,v,R[p+15],N,530742520),v=d(v,S,j,y,R[p+2],U,3299628645),y=l(y,v,S,j,R[p+0],O,4096336452),j=l(j,y,v,S,R[p+7],Q,1126891415),S=l(S,j,y,v,R[p+14],J,2878612391),v=l(v,S,j,y,R[p+5],V,4237533241),y=l(y,v,S,j,R[p+12],O,1700485571),j=l(j,y,v,S,R[p+3],Q,2399980690),S=l(S,j,y,v,R[p+10],J,4293915773),v=l(v,S,j,y,R[p+1],V,2240044497),y=l(y,v,S,j,R[p+8],O,1873313359),j=l(j,y,v,S,R[p+15],Q,4264355552),S=l(S,j,y,v,R[p+6],J,2734768916),v=l(v,S,j,y,R[p+13],V,1309151649),y=l(y,v,S,j,R[p+4],O,4149444226),j=l(j,y,v,S,R[p+11],Q,3174756917),S=l(S,j,y,v,R[p+2],J,718787259),v=l(v,S,j,y,R[p+9],V,3951481745),y=s(y,f),v=s(v,b),S=s(S,h),j=s(j,_);var q=m(y)+m(v)+m(S)+m(j);return q.toLowerCase()},sponsors=[],sponsorArray=[],numberOfSponsors,winners=[],winnersArray=[],numberOfWinners,MyBeanJarController=function(){"undefined"!=typeof this.config.debugMode?1==this.config.debugMode&&sessionStorage.clear():(null!=sessionStorage.getItem("queuedBeans")&&(this.queuedBeans=sessionStorage.getItem("queuedBeans")),null!=sessionStorage.getItem("username")&&(this.username=sessionStorage.getItem("username")),null!=sessionStorage.getItem("mbjUserLoggedIn")&&(this.userLoggedIn=sessionStorage.getItem("mbjUserLoggedIn"))),"https:"!==location.protocol&&(this.Log("Connection is insecure. Disabling the use of location services."),this.config.offerLocation=!1),""==this.config.appID?this.Log("MyBeanJar app ID not set. Add a valid app ID to mbj-ui-kit.js"):this.FetchCategories()};MyBeanJarController.prototype={config:{hardUser:"ryanfister3",hardPass:"40f4d87250c70278580bc8fb47e5caaa",appID:"",debugMode:!1,rewardLogin:!1,offerLocation:!1},constructor:MyBeanJarController,categories:{},queuedBeans:{},username:{},userLoggedIn:!1,FetchCategories:function(){get_categories(this.config.hardUser,this.config.hardPass,function(e,t){this.categories=t}.bind(this))},GetLocation:function(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(e.bind(this)):MyBeanJar.Log("Geolocation is not supported by this browser")},Log:function(e){"undefined"!=typeof this.config.debugMode&&1==this.config.debugMode&&console.log(e)},AwardBean:function(){if(this.queuedBeans=sessionStorage.getItem("queuedBeans"),this.queuedBeans++,sessionStorage.setItem("queuedBeans",this.queuedBeans),MyBeanJar.Log("Queued Bean count: "+this.queuedBeans),!jQuery(".mbj-modal").length){new MbjModal}}};var MbjModal=function(e){this.uid=Date.now(),this.Spawn(),this.element=document.getElementById("mbj-modal-"+this.uid),this.payload=document.getElementById("mbj-modal-payload-"+this.uid),this.payloadContainer=jQuery(this.payload).parent()[0],0==arguments.length||"awardbean"==e?this.AwardBean():"login"==e&&this.LoadLoginView()};MbjModal.prototype={constructor:MbjModal,uid:{},payload:{},payloadContainer:{},beanImage:{},timeout:{},loginStatusFlashing:!1,geolocation:{lat:{},lon:{}},currentView:function(){},lastView:function(){},Spawn:function(){var e=this;jQuery("body").append(modalContent.frame(e)),window.addEventListener("resize",function(){this.payloadContainer.style.maxHeight=document.documentElement.offsetHeight}.bind(this),!1)},LoadLoginView:function(){var e=this;jQuery.isEmptyObject(MyBeanJar.categories)||MyBeanJar.FetchCategories(),jQuery(this.payload).html(modalContent.login(e));var t=document.getElementById("close-modal-"+e.uid),s=document.getElementById("load-registration-view-"+e.uid),n=document.getElementById("mbj-login-button-"+e.uid);s.addEventListener("click",function(){this.LoadRegistrationView()}.bind(this)),t.addEventListener("click",function(){this.SelfDestruct()}.bind(this)),n.addEventListener("click",function(){u=jQuery("#mbj_form_u",this.element).val(),this.SubmitAuthentication(u)}.bind(this)),this.FadeIn(),this.currentView=this.LoadLoginView},LoadAwardView:function(){var e=this;this.lastView=this.currentView,jQuery(this.payload).html(modalContent.bean(e)),jQuery(".bean_notification_image").replaceWith('<img class="bean_notification_image" id="mbj_award_img" src="'+this.beanImage+'">');var t=document.getElementById("close-modal-"+this.uid);t.addEventListener("click",function(){this.SelfDestruct()}.bind(this)),this.FadeIn(),this.timeout=setTimeout(function(){this.SelfDestruct()}.bind(this),8e3),this.currentView=this.LoadAwardView},LoadRegistrationView:function(){var e=this;this.lastView=this.currentView,jQuery(this.payload).html(modalContent.registration(e)),this.ParseCategories(categories);var t=document.getElementById("back-modal-"+this.uid),s=document.getElementById("close-modal-"+this.uid),n=document.getElementById("mbj-register-button-"+this.uid);if(1==MyBeanJar.config.offerLocation){var i=document.getElementById("btn-geolocator-"+this.uid);i.addEventListener("click",function(){MyBeanJar.GetLocation.bind(this)(this.StoreLocation)}.bind(this))}t.addEventListener("click",function(){this.lastView()}.bind(this)),s.addEventListener("click",function(){this.SelfDestruct()}.bind(this)),n.addEventListener("click",function(){this.SubmitRegistration()}.bind(this)),this.currentView=this.LoadRegistrationView},ParseCategories:function(e){if("undefined"!=typeof e)var t=e.length;for(var s='<select id="mbj-form-reg-cats-'+this.uid+'" name="cats" style="width:100%" multiple="multiple">',n=0;t>n;n++){var i=e[n].name,a=e[n].categorykey;s=s+'<option value="'+a+'">'+i+"</option>"}s+="</select>",jQuery("#mbj-category-selector-"+this.uid).html(s)},ApplyLocation:function(){if(!jQuery.isEmptyObject(this.geolocation)){var e=document.getElementById("lat-"+this.uid),t=document.getElementById("lon-"+this.uid);e.value=this.geolocation.lat,t.value=this.geolocation.lon,jQuery("#geolocator-block-"+this.uid).html('<div class="notification-geolocator"><span>(Using Current Location)</span></div>')}},AwardBean:function(){var e=sessionStorage.getItem("username"),t=sessionStorage.getItem("mbjUserLoggedIn");t&&"null"!=e?(u=sessionStorage.getItem("username"),p="password",sessionStorage.getItem("queuedBeans")>0&&(jQuery("#mbj_modal").length||(MyBeanJar.Log("User logged in as "+u+" : "+p+": "+MyBeanJar.config.appID+" Requesting award Bean"),get_award(u,p,MyBeanJar.config.appID,function(e,t){MyBeanJar.Log("Award: "+t),this.beanImage=t.imageurl,this.LoadAwardView()}.bind(this)),MyBeanJar.queuedBeans=sessionStorage.getItem("queuedBeans"),MyBeanJar.queuedBeans--,sessionStorage.setItem("queuedBeans",MyBeanJar.queuedBeans),MyBeanJar.Log(MyBeanJar.queuedBeans+" queued Beans remaining...")))):this.LoadLoginView()},FadeIn:function(){jQuery(this.element).fadeIn(200,"swing")},SubmitRegistration:function(){jQuery("div.mbj_login_status").removeClass("success fail"),jQuery("div.mbj_login_status").html('<div id="spinner-login-'+this.uid+'"></div>'),this.FlashLoginStatus(),this.SummonSpinner("spinner-login-"+this.uid),u=jQuery("#mbj-form-reg-email-"+this.uid).val(),p=jQuery("#mbj-form-reg-p-"+this.uid).val(),p2=jQuery("#mbj-form-reg-p2-"+this.uid).val(),email=jQuery("#mbj-form-reg-email-"+this.uid).val(),zip=jQuery("#mbj-form-reg-zip-"+this.uid).val(),lat=jQuery("#lat-"+this.uid).val(),lon=jQuery("#lon-"+this.uid).val(),cats=jQuery("#mbj-form-reg-cats-"+this.uid).val(),p!=p2?(MyBeanJar.Log("Password mismatch detected"),this.NotifyPasswordMismatch()):p.length<5?(MyBeanJar.Log("Invalid password"),this.NotifyPasswordInvalid()):zip+lat+lon==""?(MyBeanJar.Log("Location data not supplied"),this.NotifyInsufficientLocation()):!jQuery.isEmptyObject(cats)&&cats.length<3?(MyBeanJar.Log("Insufficient categories selected"),this.NotifyInsufficientCategories()):jQuery.isEmptyObject(cats)?(MyBeanJar.Log("Insufficient categories selected"),this.NotifyInsufficientCategories()):register_user(u,p,email,zip,lat,lon,cats,function(e,t){this.UpdateRegistrationStatus(e,t)}.bind(this))},SubmitAuthentication:function(e){jQuery("div.mbj_login_status").removeClass("success fail"),jQuery("div.mbj_login_status").html('<div id="spinner-login-'+this.uid+'"></div>'),"undefined"!=typeof e&&sessionStorage.setItem("username",e),this.FlashLoginStatus.bind(this)(),this.SummonSpinner("spinner-login-"+this.uid),validate_user(e,function(e,t){this.UpdateAuthenticationStatus(e,t)}.bind(this)),MyBeanJar.Log("Queued Bean count: "+MyBeanJar.queuedBeans)},UpdateAuthenticationStatus:function(e,t,s){MyBeanJar.Log("Authenticating..."),e==STATUS_SUCCESS?(MyBeanJar.Log("Result = "+e),MyBeanJar.Log("Message = "+t),MyBeanJar.Log("Authentication succeeded."),MyBeanJar.userLoggedIn=!0,sessionStorage.setItem("mbjUserLoggedIn","true"),setTimeout(function(){jQuery("div.mbj_login_status").addClass("success"),jQuery("div.mbj_login_status").html('<img src="img/ui_action_success.png"><p class="status success">Login successful.</p>'),this.FlashLoginStatus(),this.timeout=setTimeout(function(){this.SelfDestruct()}.bind(this),2e3)}.bind(this),200)):(MyBeanJar.Log("Result = "+e),MyBeanJar.Log("Message = "+t),MyBeanJar.Log("Authentication failed."),setTimeout(function(){jQuery("div.mbj_login_status").addClass("fail"),jQuery("div.mbj_login_status").html('<img src="img/ui_action_fail.png"><p class="status fail">Login failed.</p>'),this.FlashLoginStatus()}.bind(this),200))},LoadRegistrationSuccessView:function(){var e=this;this.lastView=this.currentView,jQuery(this.payload).html(modalContent.registrationSuccess(e));var t=document.getElementById("close-modal-"+e.uid),s=document.getElementById("close-modal-button-"+e.uid);t.addEventListener("click",function(){e.SelfDestruct()}),s.addEventListener("click",function(){e.SelfDestruct()}),this.currentView=this.LoadRegistrationSuccessView},UpdateRegistrationStatus:function(e,t){e==STATUS_SUCCESS?(MyBeanJar.Log("Result = "+e),MyBeanJar.Log("Message = "+t),MyBeanJar.Log("Registration succeeded as "+email),sessionStorage.setItem("username",email),MyBeanJar.userLoggedIn=!0,sessionStorage.setItem("mbjUserLoggedIn","true"),jQuery("#email").val(email),jQuery("#mbj-form-reg-email").val(email),setTimeout(function(){jQuery("div.mbj_login_status").addClass("success"),jQuery("div.mbj_login_status").html('<img src="img/ui_action_success.png"><p class="status success">Login successful.</p>'),this.FlashLoginStatus(),setTimeout(function(){this.LoadRegistrationSuccessView()}.bind(this),2e3)}.bind(this),200)):(MyBeanJar.Log("Result = "+e),MyBeanJar.Log("Message = "+t),MyBeanJar.Log("Registration failed."),setTimeout(function(){jQuery("div.mbj_login_status").addClass("fail"),jQuery("div.mbj_login_status").html('<img src="img/ui_action_fail.png"><p class="status fail">Registration failed. '+t+" </p>"),this.FlashLoginStatus()}.bind(this),200))},NotifyPasswordMismatch:function(){setTimeout(function(){jQuery("div.mbj_login_status").addClass("fail"),jQuery("div.mbj_login_status").html(modalContent.notify.passwordMismatch(this)),this.FlashLoginStatus(),jQuery("#mbj-form-reg-p-"+this.uid).css({backgroundColor:"#dd8d82"}),jQuery("#mbj-form-reg-p2-"+this.uid).css({backgroundColor:"#dd8d82"})}.bind(this),200),setTimeout(function(){jQuery("#mbj-form-reg-p-"+this.uid).css({backgroundColor:"#ffffff"}),jQuery("#mbj-form-reg-p2-"+this.uid).css({backgroundColor:"#ffffff"})}.bind(this),3e3)},NotifyPasswordInvalid:function(){setTimeout(function(){jQuery("div.mbj_login_status").addClass("fail"),jQuery("div.mbj_login_status").html(modalContent.notify.invalidPassword(this)),this.FlashLoginStatus(),jQuery("#mbj-form-reg-p-"+this.uid).css({backgroundColor:"#dd8d82"}),jQuery("#mbj-form-reg-p2-"+this.uid).css({backgroundColor:"#dd8d82"})}.bind(this),200),setTimeout(function(){jQuery("#mbj-form-reg-p-"+this.uid).css({backgroundColor:"#ffffff"}),jQuery("#mbj-form-reg-p2-"+this.uid).css({backgroundColor:"#ffffff"})}.bind(this),3e3)},NotifyLocationInvalid:function(){setTimeout(function(){jQuery("div.mbj_login_status").addClass("fail"),jQuery("div.mbj_login_status").html(modalContent.notify.invalidLocation(this)),this.FlashLoginStatus(),jQuery("#mbj-form-reg-zip"+this.uid).css({backgroundColor:"#dd8d82"})}.bind(this),200),setTimeout(function(){jQuery("#mbj-form-reg-zip"+this.uid).css({backgroundColor:"#ffffff"})}.bind(this),3e3)},NotifyInsufficientLocation:function(){setTimeout(function(){jQuery("div.mbj_login_status").addClass("fail"),jQuery("div.mbj_login_status").html(modalContent.notify.insufficientLocation(this)),this.FlashLoginStatus(),jQuery("#mbj-form-reg-zip-"+this.uid).css({backgroundColor:"#dd8d82"})}.bind(this),200),setTimeout(function(){jQuery("#mbj-form-reg-zip-"+this.uid).css({backgroundColor:"#ffffff"})}.bind(this),3e3)},NotifyInsufficientCategories:function(){setTimeout(function(){jQuery("div.mbj_login_status").addClass("fail"),jQuery("div.mbj_login_status").html(modalContent.notify.insufficientCategories(this)),this.FlashLoginStatus(),jQuery("#mbj-form-reg-cats-"+this.uid).css({backgroundColor:"#dd8d82"})}.bind(this),200),setTimeout(function(){jQuery("#mbj-form-reg-cats-"+this.uid).css({backgroundColor:"#ffffff"})}.bind(this),3e3)},FlashLoginStatus:function(){if(!this.loginStatusFlashing){this.loginStatusFlashing=!0;var e="#mbj-login-status-"+this.uid;jQuery(e).finish().animate({opacity:1},0).slideDown().fadeIn(200).delay(3e3).animate({opacity:0},200).slideUp(function(){this.loginStatusFlashing=!1}.bind(this))}},CenterSelf:function(){jQuery(this.payload).each(function(){MyBeanJar.Log("This.height: "+jQuery(this).outerHeight()),MyBeanJar.Log("Parent.height: "+jQuery(this).innerHeight()),jQuery(this).css("left",(jQuery(window).innerWidth()-jQuery(this).outerWidth())/2+"px"),jQuery(this).css("top",(jQuery(window).innerHeight()-jQuery(this).outerHeight())/3+"px")})},SummonSpinner:function(e){var t={lines:12,length:7,width:2,radius:5,corners:1,rotate:0,direction:1,color:"#fff",speed:1,trail:60,shadow:!1,hwaccel:!0,className:"mbj-activity-indicator",zIndex:2e9,top:"50%",left:"50%"},s=document.getElementById(e);new Spinner(t).spin(s)},StoreLocation:function(e){this.geolocation.lat=e.coords.latitude,this.geolocation.lon=e.coords.longitude,this.currentView==this.LoadRegistrationView&&this.ApplyLocation()},SelfDestruct:function(){clearTimeout(this.timeout),jQuery(this.element).fadeOut(200,"swing",function(){jQuery(this).remove(),MyBeanJar.config.rewardLogin&&sessionStorage.getItem("mbjUserLoggedIn")&&sessionStorage.getItem("queuedBeans")>0&&new MbjModal("awardbean")})}};var modalContent={frame:function(e){return htmlementString='<table class="mbj-modal" id="mbj-modal-'+e.uid+'">    <tbody id="modal-tbody">        <tr id="modal-tr">            <td id="modal-td">                <div id="modal-box">                    <div id="modal-content">                        <div class="mbj-notification mbj-modal-payload" id="mbj-modal-payload-'+e.uid+'">                        </div>                    </div>                </div>            </td>        </tr>    </tbody></table>',htmlementString},login:function(e){return htmlementString='<div class="mbj-notification mbj-modal-payload mbj_notification_container onboard-modal" id="mbj-modal-payload-'+e.uid+'">    <div class="mbj_notification_inner" id="mbj-youvewon-init">        <div class="mbj_notification_sub_inner">            <form class="mbj-form" id="mbj_login_form2" method="post" onsubmit="return false">                <div id="mbj-label-init-username">                    <span>MBJ users<br>log in</span>                </div>                <div class="element-input" id="mbj-field-init-username">                    <input class="" id="mbj_form_u" type="text" name="mbj_login" required />                </div>                <button class="submit" id="mbj-login-button-'+e.uid+'">                    <span class="mbj-button-text">Log In</span>                </button>            </form>        </div>        <div id="mbj-onboard-buttons">            <img id="close-modal-'+e.uid+'" src="img/forfun.png"></a>            <img id="load-registration-view-'+e.uid+'" src="img/rewards.png"></a>        </div>    </div></div>',htmlementString},registration:function(e){var t;return t=1==MyBeanJar.config.offerLocation?'                    <div class="geolocator-block" id="geolocator-block-'+e.uid+'">                        <span class="mbj-form-label">&nbsp;or&nbsp;</span>                        <button type="button" class="btn-mbj green btn-location" id="btn-geolocator-'+e.uid+'">                            <span class="mbj-button-text" style="color:black;font-size:8pt">current location</span>                        </button>                    </div>':"",htmlementString='<div class="mbj-notification mbj-modal-payload mbj_notification_container onboard-modal" id="mbj-modal-payload-'+e.uid+'"><div class="mbj_notification_inner" id="mbj-login-details">    <div class="mbj-nav-button-block">            <button type="submit" class="btn-back" id="back-modal-'+e.uid+'">                <img src="img/ui_action_back.png">            </button>            <button type="submit" class="btn-close" id="close-modal-'+e.uid+'">                <img src="img/ui_action_close.png">            </button>        </div>        <br clear="all">        <div class="mbj_notification_title">            <h2>get real&mdash;redeem NOW!</h2>            <h3>Real stuff, not points or badges. Instant redemption from anywhere.</h3>        </div>        <div class="mbj-login mbj-form-block" id="mbj_details">            <form class="mbj-form" id="mbj_details_form" method="post">                <input type="hidden" name="lat" id="lat-'+e.uid+'" value=""/>                <input type="hidden" name="lon" id="lon-'+e.uid+'" value=""/>                <div class="element-input">                    <label class="title mbj-form-label">email&mdash;no spam ever</label>                    <input class="large" id="mbj-form-reg-email-'+e.uid+'" type="email" name="mbj_reg_email" required/>                </div>                <div style="width: 100%;padding-top:5px">                       <div class="element-input" style="width:45%;float:left;">                                <label class="title mbj-form-label">password (&gt;5 chars)</label>                                <input class="small" style="width:100%;" id="mbj-form-reg-p-'+e.uid+'" type="password" name="mbj_password" required="">                        </div>                        <div class="element-input" style="width: 45%;float:right;margin-top:0px">                            <label class="title mbj-form-label">confirm password</label>                            <input class="small" style="width:100%;" id="mbj-form-reg-p2-'+e.uid+'" type="password" name="mbj_password_confirm">                        </div>                </div>                <div style="width: 100%;padding-top:5px;white-space:nowrap;display:inline-block">                    <div class="element-input" >                        <label class="title mbj-form-label">ZIP (US only)&mdash;to find cool stuff nearby</label>                        <input class="small"  style="width:45%;" maxlength="5" id="mbj-form-reg-zip-'+e.uid+'" type="text" name="mbj_reg_zip"/>                       '+t+'                    </div>                </div>                <div class="element-input">                    <label class="title mbj-form-label"><br>Choose only the rewards you want (select 3+)</label>                    <div class="mbj-category-selector" id="mbj-category-selector-'+e.uid+'">                    </div>                </div>                <div class="mbj_login_status" id="mbj-login-status-'+e.uid+'">                </div>            </form>        </div>        <div class="submit action-buttons">            <a href="http://www.mybeanjar.com/#players" style="text-decoration:none">                <img src="img/bean.png" style="vertical-align:middle"><span>&nbsp;myBeanJar.com</span>            </a>            <button class="btn-mbj green submit small" style="float:right" id="mbj-register-button-'+e.uid+'">                    <span class="mbj-button-text">done</span>            </button>        </div>    </div></div>',
htmlementString},registrationSuccess:function(e){return htmlementString='<div class="mbj-notification mbj-modal-payload mbj_notification_container onboard-modal" id="mbj-modal-payload-'+e.uid+'">    <div class="mbj_notification_inner" id="mbj-registration-successful">        <div class="mbj-nav-button-block">            <button type="submit" class="btn-close" id="close-modal-'+e.uid+'">                <img src="img/ui_action_close.png">            </button>        </div>        <div class="mbj_notification_title">            <h2>YOU\'RE IN!</h2>            <p>Keep playing to win more in this game.</p>            <p>Check your email later for instructions on how to redeem your rewards, and install the MyBeanJar app.</p>        </div>        <button class="btn-mbj submit" id="close-modal-button-'+e.uid+'">            <span class="mbj-button-text">Play On</span>        </button>    </div>',htmlementString},bean:function(e){return htmlementString='<div class="mbj-notification bean_notification_window" id="mbj-bean-modal-'+e.uid+'">    <button type="submit" class="btn-close" id="close-modal-'+e.uid+'">        <img src="img/ui_action_close.png">    </button>    <img class="bean_notification_image" src=""></div>',htmlementString},notify:{passwordMismatch:function(e){return'<img src="img/ui_action_fail.png"><p class="status success">Passwords do not not not match.</p>'},insufficientCategories:function(e){return'<img src="img/ui_action_fail.png"><p class="status success">You must select at least 3 categories.</p>'},invalidPassword:function(e){return'<img src="img/ui_action_fail.png"><p class="status success">Password must be at least 6 alphanumeric characters. Special characters not allowed.</p>'},insufficientLocation:function(e){return'<img src="img/ui_action_fail.png"><p class="status success">No location data provided.</p>'}}},MyBeanJar=new MyBeanJarController,mbjAddAwardBean=function(){return MyBeanJar.AwardBean()};